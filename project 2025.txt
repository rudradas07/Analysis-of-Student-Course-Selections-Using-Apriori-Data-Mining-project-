# Title: Analysis of Student Course Selections Using Apriori

# Step 1: Install necessary libraries
!pip install mlxtend pandas matplotlib

# Step 2: Import Libraries
import pandas as pd
from mlxtend.frequent_patterns import apriori, association_rules
import matplotlib.pyplot as plt

# Step 3: Create a sample dataset
# Each row = one student's selected courses
data = [
    ['Data Mining', 'Machine Learning', 'AI'],
    ['Data Mining', 'Big Data', 'Data Visualization'],
    ['AI', 'Deep Learning', 'Machine Learning'],
    ['Cyber Security', 'Data Mining', 'Networking'],
    ['Machine Learning', 'Data Mining', 'Big Data'],
    ['AI', 'Data Science', 'Machine Learning'],
    ['Data Visualization', 'Big Data', 'Data Mining'],
    ['Networking', 'Cyber Security', 'Data Mining'],
    ['Data Mining', 'Machine Learning', 'Deep Learning'],
    ['Big Data', 'Data Visualization', 'AI']
]

# Step 4: Convert dataset into DataFrame
df = pd.DataFrame(data, columns=['Course1', 'Course2', 'Course3'])
print("Sample Course Selection Data:")
print(df.head())

# Step 5: Convert to one-hot encoded format
from mlxtend.preprocessing import TransactionEncoder
te = TransactionEncoder()
te_ary = te.fit(data).transform(data)
df_encoded = pd.DataFrame(te_ary, columns=te.columns_)

print("\nOne-Hot Encoded Data:")
print(df_encoded.head())

# Step 6: Apply Apriori Algorithm
frequent_itemsets = apriori(df_encoded, min_support=0.3, use_colnames=True)
frequent_itemsets = frequent_itemsets.sort_values(by='support', ascending=False)

print("\nFrequent Itemsets:")
print(frequent_itemsets)

# Step 7: Generate Association Rules
rules = association_rules(frequent_itemsets, metric="confidence", min_threshold=0.6)
rules = rules.sort_values(by='confidence', ascending=False)

print("\nAssociation Rules:")
print(rules[['antecedents', 'consequents', 'support', 'confidence', 'lift']])

# Step 8: Visualization
plt.figure(figsize=(8,5))
plt.scatter(rules['support'], rules['confidence'], alpha=0.6)
plt.title('Support vs Confidence')
plt.xlabel('Support')
plt.ylabel('Confidence')
plt.grid(True)
plt.show()

# Step 9: Insights
print("\nüîç Insights:")
for _, row in rules.iterrows():
    print(f"If a student takes {list(row['antecedents'])}, "
          f"they are likely to take {list(row['consequents'])} "
          f"(confidence: {row['confidence']:.2f}, lift: {row['lift']:.2f})")
